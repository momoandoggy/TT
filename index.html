<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aktivator Pixel TikTok</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .card {
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .header {
            background: linear-gradient(135deg, #000000 0%, #2d2d2d 100%);
            color: white;
            padding: 30px 0;
            margin-bottom: 30px;
            text-align: center;
        }
        .logo {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .logo span {
            color: #69C9D0;
        }
        .step {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f0f8ff;
            border-radius: 10px;
        }
        .step-number {
            width: 40px;
            height: 40px;
            background-color: #0d6efd;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            flex-shrink: 0;
        }
        .progress {
            height: 8px;
            margin: 20px 0;
        }
        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        .btn-primary {
            background-color: #000000;
            border-color: #000000;
        }
        .btn-primary:hover {
            background-color: #69C9D0;
            border-color: #69C9D0;
            color: #000;
        }
        .success-check {
            color: #28a745;
            font-size: 80px;
            margin-bottom: 20px;
        }
        #purchaseDetails {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }
        .pixel-config {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
    </style>
    <!-- TikTok Pixel Code -->
    <script>
        // Fungsi untuk memuat TikTok Pixel
        function loadTikTokPixel(pixelId) {
            // Hapus pixel sebelumnya jika ada
            if (window.ttq) {
                delete window.ttq;
            }
            
            // Buat script pixel
            var script = document.createElement('script');
            script.innerHTML = `
                !function (w, d, t) {
                    w.TiktokAnalyticsObject=t;var ttq=w[t]=w[t]||[];ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie"],ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);ttq.instance=function(t){for(var e=ttq._i[t]||[],n=0;n<ttq.methods.length;n++)ttq.setAndDefer(e,ttq.methods[n]);return e},ttq.load=function(e,n){var i="https://analytics.tiktok.com/i18n/pixel/events.js";ttq._i=ttq._i||{},ttq._i[e]=[],ttq._i[e]._u=i,ttq._t=ttq._t||{},ttq._t[e]=+new Date,ttq._o=ttq._o||{},ttq._o[e]=n||{};var o=document.createElement("script");o.type="text/javascript",o.async=!0,o.src=i+"?sdkid="+e+"&lib="+t;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(o,a)};
                    ttq.load('${pixelId}');
                    ttq.page();
                }(window, document, 'ttq');
            `;
            document.head.appendChild(script);
            
            console.log(`TikTok Pixel ${pixelId} dimuat`);
        }
    </script>
</head>
<body>
    <div class="header">
        <div class="container">
            <div class="logo">TikTok <span>Pixel</span> Activator</div>
            <p class="lead">Aktifkan event Pixel TikTok untuk Purchase dan Register</p>
        </div>
    </div>

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="card">
                    <div class="card-body p-5">
                        <h3 class="card-title text-center mb-4">Aktivasi Pixel TikTok</h3>
                        <p class="text-muted text-center">Masukkan link aktivasi atau Pixel ID di bawah ini untuk memulai proses</p>
                        
                        <div class="pixel-config mb-4">
                            <div class="row">
                                <div class="col-md-6">
                                    <label for="pixelId" class="form-label">Pixel ID</label>
                                    <input type="text" class="form-control" id="pixelId" placeholder="CM3C2F77SJN5G97J9UR0">
                                </div>
                                <div class="col-md-6">
                                    <label for="activationLink" class="form-label">Link Aktivasi</label>
                                    <input type="text" class="form-control" id="activationLink" placeholder="https://example.com/activate?id=12345">
                                </div>
                            </div>
                            <div class="form-text mt-2">Anda bisa menggunakan Pixel ID langsung atau link aktivasi</div>
                        </div>
                        
                        <div class="progress">
                            <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        
                        <div id="activationStatus" class="alert alert-info">
                            <strong>Status:</strong> <span id="statusText">Menunggu aktivasi...</span>
                        </div>
                        
                        <div id="stepsContainer">
                            <div class="step">
                                <div class="step-number">1</div>
                                <div class="step-content">
                                    <h5 class="mb-1">Memverifikasi Pixel</h5>
                                    <p class="mb-0 text-muted">Memvalidasi Pixel ID atau link aktivasi</p>
                                </div>
                                <div class="ms-auto">
                                    <span id="step1Status" class="status-badge badge bg-secondary">Menunggu</span>
                                </div>
                            </div>
                            
                            <div class="step">
                                <div class="step-number">2</div>
                                <div class="step-content">
                                    <h5 class="mb-1">Trigger Event Register</h5>
                                    <p class="mb-0 text-muted">Mengaktifkan event register di Pixel TikTok</p>
                                </div>
                                <div class="ms-auto">
                                    <span id="step2Status" class="status-badge badge bg-secondary">Menunggu</span>
                                </div>
                            </div>
                            
                            <div class="step">
                                <div class="step-number">3</div>
                                <div class="step-content">
                                    <h5 class="mb-1">Trigger Event Purchase</h5>
                                    <p class="mb-0 text-muted">Mengaktifkan event purchase dengan nilai 10 Real Brasil</p>
                                </div>
                                <div class="ms-auto">
                                    <span id="step3Status" class="status-badge badge bg-secondary">Menunggu</span>
                                </div>
                            </div>
                            
                            <div class="step">
                                <div class="step-number">4</div>
                                <div class="step-content">
                                    <h5 class="mb-1">Konfirmasi Berhasil</h5>
                                    <p class="mb-0 text-muted">Menyelesaikan seluruh proses aktivasi</p>
                                </div>
                                <div class="ms-auto">
                                    <span id="step4Status" class="status-badge badge bg-secondary">Menunggu</span>
                                </div>
                            </div>
                        </div>
                        
                        <div id="purchaseDetails" class="d-none">
                            <h5>Detail Purchase</h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>Nilai Purchase:</strong> 10 BRL (Real Brasil)</p>
                                    <p><strong>Mata Uang:</strong> BRL</p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>ID Transaksi:</strong> <span id="transactionId">TRX-</span></p>
                                    <p><strong>Status:</strong> Berhasil</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-center mt-4">
                            <button id="activateButton" class="btn btn-primary btn-lg">Aktifkan Pixel</button>
                            <button id="resetButton" class="btn btn-outline-secondary btn-lg ms-2 d-none">Reset</button>
                        </div>
                        
                        <div id="successMessage" class="alert alert-success mt-4 text-center d-none">
                            <div class="success-check">âœ“</div>
                            <h4>Aktivasi Berhasil!</h4>
                            <p>Event Register dan Purchase telah berhasil diaktifkan pada Pixel TikTok.</p>
                        </div>
                    </div>
                </div>
                
                <div class="card mt-4">
                    <div class="card-body">
                        <h5 class="card-title">Riwayat Aktivasi</h5>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Waktu</th>
                                        <th>Pixel ID</th>
                                        <th>Event</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="historyTable">
                                    <!-- Riwayat akan diisi secara dinamis -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const activateButton = document.getElementById('activateButton');
            const resetButton = document.getElementById('resetButton');
            const pixelIdInput = document.getElementById('pixelId');
            const activationLinkInput = document.getElementById('activationLink');
            const progressBar = document.getElementById('progressBar');
            const statusText = document.getElementById('statusText');
            const purchaseDetails = document.getElementById('purchaseDetails');
            const successMessage = document.getElementById('successMessage');
            const historyTable = document.getElementById('historyTable');
            
            // Status steps
            const step1Status = document.getElementById('step1Status');
            const step2Status = document.getElementById('step2Status');
            const step3Status = document.getElementById('step3Status');
            const step4Status = document.getElementById('step4Status');
            
            activateButton.addEventListener('click', startActivation);
            resetButton.addEventListener('click', resetForm);
            
            function startActivation() {
                const pixelId = pixelIdInput.value.trim();
                const activationLink = activationLinkInput.value.trim();
                
                // Validasi input
                if (!pixelId && !activationLink) {
                    showStatus('Masukkan Pixel ID atau Link Aktivasi', 'danger');
                    return;
                }
                
                // Nonaktifkan tombol selama proses
                activateButton.disabled = true;
                activateButton.textContent = 'Memproses...';
                
                // Ekstrak Pixel ID dari link jika menggunakan link
                let extractedPixelId = pixelId;
                if (!pixelId && activationLink) {
                    const urlParams = new URLSearchParams(activationLink.split('?')[1]);
                    extractedPixelId = urlParams.get('pixelId') || urlParams.get('id') || 'CM3C2F77SJN5G97J9UR0';
                    pixelIdInput.value = extractedPixelId;
                }
                
                // Validasi format Pixel ID
                if (!isValidPixelId(extractedPixelId)) {
                    showStatus('Format Pixel ID tidak valid', 'danger');
                    activateButton.disabled = false;
                    activateButton.textContent = 'Aktifkan Pixel';
                    return;
                }
                
                // Mulai proses aktivasi
                showStatus('Memulai proses aktivasi...', 'info');
                updateProgress(10);
                updateStepStatus(step1Status, 'progress', 'Memverifikasi');
                
                // Simulasi proses verifikasi
                setTimeout(() => {
                    updateProgress(30);
                    updateStepStatus(step1Status, 'success', 'Terverifikasi');
                    
                    // Load TikTok Pixel
                    loadTikTokPixel(extractedPixelId);
                    showStatus('Pixel TikTok dimuat, mengaktifkan event...', 'info');
                    
                    // Trigger event Register
                    updateStepStatus(step2Status, 'progress', 'Memproses');
                    setTimeout(() => {
                        triggerRegisterEvent(extractedPixelId);
                        updateProgress(50);
                        updateStepStatus(step2Status, 'success', 'Berhasil');
                        
                        // Trigger event Purchase
                        updateStepStatus(step3Status, 'progress', 'Memproses');
                        setTimeout(() => {
                            const transactionId = triggerPurchaseEvent(extractedPixelId);
                            document.getElementById('transactionId').textContent = transactionId;
                            updateProgress(80);
                            updateStepStatus(step3Status, 'success', 'Berhasil');
                            purchaseDetails.classList.remove('d-none');
                            
                            // Finalisasi
                            updateStepStatus(step4Status, 'progress', 'Menyelesaikan');
                            setTimeout(() => {
                                updateProgress(100);
                                updateStepStatus(step4Status, 'success', 'Berhasil');
                                showStatus('Aktivasi berhasil! Event Register dan Purchase telah diaktifkan.', 'success');
                                
                                // Tampilkan pesan sukses
                                successMessage.classList.remove('d-none');
                                resetButton.classList.remove('d-none');
                                
                                // Tambahkan ke riwayat
                                addToHistory(extractedPixelId, transactionId);
                            }, 1500);
                        }, 1500);
                    }, 1500);
                }, 1500);
            }
            
            function triggerRegisterEvent(pixelId) {
                // Simulasi trigger event Register
                if (window.ttq) {
                    try {
                        ttq.instance(pixelId).track('Register', {
                            content_type: 'activation',
                            user_id: 'user_' + Math.floor(Math.random() * 1000000)
                        });
                        console.log('Register event triggered');
                    } catch (e) {
                        console.error('Error triggering Register event:', e);
                    }
                }
            }
            
            function triggerPurchaseEvent(pixelId) {
                // Simulasi trigger event Purchase
                const transactionId = 'TRX-' + Math.floor(Math.random() * 1000000000);
                
                if (window.ttq) {
                    try {
                        ttq.instance(pixelId).track('Purchase', {
                            content_type: 'product',
                            quantity: 1,
                            price: 10,
                            currency: 'BRL',
                            value: 10,
                            order_id: transactionId
                        });
                        console.log('Purchase event triggered');
                    } catch (e) {
                        console.error('Error triggering Purchase event:', e);
                    }
                }
                
                return transactionId;
            }
            
            function updateProgress(percent) {
                progressBar.style.width = percent + '%';
                progressBar.setAttribute('aria-valuenow', percent);
            }
            
            function updateStepStatus(element, status, text) {
                element.textContent = text;
                
                // Hapus semua kelas status
                element.classList.remove('bg-secondary', 'bg-warning', 'bg-success', 'bg-danger');
                
                // Tambahkan kelas sesuai status
                if (status === 'waiting') element.classList.add('bg-secondary');
                else if (status === 'progress') element.classList.add('bg-warning');
                else if (status === 'success') element.classList.add('bg-success');
                else if (status === 'error') element.classList.add('bg-danger');
            }
            
            function showStatus(message, type) {
                statusText.textContent = message;
                const statusElement = document.getElementById('activationStatus');
                
                // Hapus semua kelas alert
                statusElement.classList.remove('alert-info', 'alert-success', 'alert-danger');
                
                // Tambahkan kelas sesuai type
                if (type === 'info') statusElement.classList.add('alert-info');
                else if (type === 'success') statusElement.classList.add('alert-success');
                else if (type === 'danger') statusElement.classList.add('alert-danger');
                
                statusElement.classList.remove('d-none');
            }
            
            function resetForm() {
                // Reset form
                pixelIdInput.value = '';
                activationLinkInput.value = '';
                updateProgress(0);
                
                // Reset status
                showStatus('Menunggu aktivasi...', 'info');
                updateStepStatus(step1Status, 'waiting', 'Menunggu');
                updateStepStatus(step2Status, 'waiting', 'Menunggu');
                updateStepStatus(step3Status, 'waiting', 'Menunggu');
                updateStepStatus(step4Status, 'waiting', 'Menunggu');
                
                // Sembunyikan elemen
                purchaseDetails.classList.add('d-none');
                successMessage.classList.add('d-none');
                resetButton.classList.add('d-none');
                
                // Aktifkan tombol
                activateButton.disabled = false;
                activateButton.textContent = 'Aktifkan Pixel';
            }
            
            function addToHistory(pixelId, transactionId) {
                const now = new Date();
                const timeString = now.toLocaleTimeString();
                const dateString = now.toLocaleDateString();
                
                const newRow = document.createElement('tr');
                newRow.innerHTML = `
                    <td>${dateString} ${timeString}</td>
                    <td>${pixelId}</td>
                    <td>Register, Purchase</td>
                    <td><span class="badge bg-success">Berhasil</span></td>
                `;
                
                historyTable.prepend(newRow);
            }
            
            function isValidPixelId(pixelId) {
                // Validasi sederhana untuk Pixel ID
                return pixelId.length >= 15 && /^[A-Z0-9]+$/.test(pixelId);
            }
        });
    </script>
</body>
</html>
